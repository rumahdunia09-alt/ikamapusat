<div id="masterBarang" class="page">
    <h1>Master Barang</h1>
    <div style="display: grid; grid-template-columns: 300px 1fr; gap: 20px;">
        <div class="card">
            <h3>Input Barang</h3>
            <input type="text" id="mKode" placeholder="Barcode (Harus Unik)">
            <input type="text" id="mNama" placeholder="Nama Barang">
            <input type="number" id="mModal" placeholder="Harga Modal">
            <input type="number" id="mJual" placeholder="Harga Jual">
            <input type="number" id="mStok" placeholder="Stok">
            <button class="btn btn-success" style="width:100%" onclick="simpanBarang()">SIMPAN</button>
        </div>
        <div class="card">
            <div class="excel-container">
                <table class="excel-table">
                    <thead>
                        <tr>
                            <th>Barcode</th>
                            <th>Nama</th>
                            <th>Modal</th>
                            <th>Jual</th>
                            <th>Laba</th>
                            <th>Stok</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="tabelMaster"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // Database Init
    let dbBarang = JSON.parse(localStorage.getItem('v9_barang')) || [];

    function simpanBarang() {
        const k = document.getElementById('mKode').value.trim();
        const n = document.getElementById('mNama').value;
        const m = parseInt(document.getElementById('mModal').value) || 0;
        const j = parseInt(document.getElementById('mJual').value) || 0;
        const s = parseInt(document.getElementById('mStok').value) || 0;

        if(!k || !n) return alert("Barcode dan Nama wajib diisi!");

        // LOGIKA MENGHINDARI DOUBLE BARANG
        const isDuplicate = dbBarang.some(barang => barang.kode === k);
        if(isDuplicate) {
            return alert("GAGAL: Kode Barcode '" + k + "' sudah terdaftar! Gunakan kode lain.");
        }

        // HITUNG LABA (Laba = Harga Jual - Modal)
        const laba = j - m;

        const dataBaru = {
            kode: k,
            nama: n,
            modal: m,
            jual: j,
            laba: laba,
            stok: s
        };

        dbBarang.unshift(dataBaru);
        localStorage.setItem('v9_barang', JSON.stringify(dbBarang));
        
        alert("Barang berhasil ditambahkan!");
        renderMaster();
        resetFormMaster();
    }

    function renderMaster() {
        const t = document.getElementById('tabelMaster');
        t.innerHTML = '';
        
        dbBarang.forEach((x, i) => {
            t.innerHTML += `<tr>
                <td><b>${x.kode}</b></td>
                <td>${x.nama}</td>
                <td>Rp ${x.modal.toLocaleString()}</td>
                <td>Rp ${x.jual.toLocaleString()}</td>
                <td style="color: green; font-weight: bold;">Rp ${x.laba.toLocaleString()}</td>
                <td>${x.stok}</td>
                <td>
                    <button class="btn-danger" style="padding: 5px;" onclick="hapusBarang(${i})">Hapus</button>
                </td>
            </tr>`;
        });
    }

    function hapusBarang(i) {
        if(confirm("Hapus barang ini?")) {
            dbBarang.splice(i, 1);
            localStorage.setItem('v9_barang', JSON.stringify(dbBarang));
            renderMaster();
        }
    }

    function resetFormMaster() {
        ['mKode','mNama','mModal','mJual','mStok'].forEach(id => document.getElementById(id).value = '');
    }
</script>
