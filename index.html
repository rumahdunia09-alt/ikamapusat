<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Kasir v9.0 - User Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --primary: #2c3e50; --success: #27ae60; --info: #3498db; 
            --warning: #f39c12; --danger: #e74c3c; --light: #f4f7f6; 
        }
        
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--light); color: #333; }
        
        /* LOGIN PAGE */
        #loginPage { position: fixed; inset: 0; background: var(--primary); display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .login-card { background: white; padding: 40px; border-radius: 15px; width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .logo-login { width: 100px; height: 100px; object-fit: contain; margin-bottom: 20px; }

        /* LAYOUT & SIDEBAR */
        #appContainer { display: none; min-height: 100vh; }
        .sidebar { width: 240px; height: 100vh; background: var(--primary); position: fixed; color: white; display: flex; flex-direction: column; }
        .sidebar-header { text-align: center; padding: 20px; border-bottom: 1px solid #34495e; }
        .logo-sidebar { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid var(--success); margin-bottom: 10px; }
        .sidebar h2 { margin: 0; font-size: 1.1rem; text-transform: uppercase; }
        
        .nav-link { padding: 15px 25px; display: block; color: #bdc3c7; text-decoration: none; cursor: pointer; border-left: 5px solid transparent; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { background: #34495e; color: white; border-left-color: var(--success); }
        .logout-btn { background: var(--danger); margin-top: auto; }

        .main-content { margin-left: 240px; padding: 30px; width: calc(100% - 240px); box-sizing: border-box; }
        .page { display: none; }
        .page.active { display: block; }

        /* UI ELEMENTS */
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; }
        .btn-success { background: var(--success); } .btn-danger { background: var(--danger); }
        
        /* TABLES */
        .excel-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; background: white; }
        .excel-table th { background: #e6e6e6; border: 1px solid #ccc; padding: 10px; text-align: left; }
        .excel-table td { border: 1px solid #e0e0e0; padding: 8px 10px; }

        @media print { body * { visibility: hidden; } #areaStruk, #areaStruk * { visibility: visible; display: block !important; position: absolute; left: 0; top: 0; } }
    </style>
</head>
<body>

<div id="loginPage">
    <div class="login-card">
        <img src="https://github.com/user-attachments/assets/70f581ca-4652-42b6-829a-8a7952f6249a" alt="Logo" class="logo-login">
        <h2>MASUK SISTEM</h2>
        <input type="text" id="username" placeholder="Masukkan Username">
        <input type="password" id="password" placeholder="Masukkan Password">
        <button class="btn btn-success" style="width: 100%" onclick="doLogin()">LOGIN</button>
    </div>
</div>

<div id="appContainer">
    <div class="sidebar">
        <div class="sidebar-header">
            <img src="https://github.com/user-attachments/assets/70f581ca-4652-42b6-829a-8a7952f6249a" alt="Logo" class="logo-sidebar">
            <h2 id="displayUser">USER</h2>
        </div>
        
        <div id="menuAdminOnly">
            <div class="nav-link" onclick="showPage('dashboard')"><i class="fas fa-chart-pie"></i> Dashboard</div>
            <div class="nav-link" onclick="showPage('masterBarang')"><i class="fas fa-database"></i> Master Barang</div>
            <div class="nav-link" onclick="showPage('manajemenUser')"><i class="fas fa-users-cog"></i> Manajemen User</div>
        </div>

        <div class="nav-link active" onclick="showPage('transaksi')"><i class="fas fa-shopping-cart"></i> Kasir</div>
        
        <div id="menuLaporanOnly">
            <div class="nav-link" onclick="showPage('laporan')"><i class="fas fa-file-invoice-dollar"></i> Laporan</div>
        </div>

        <div class="nav-link logout-btn" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Keluar</div>
    </div>

    <div class="main-content">
        <div id="transaksi" class="page active">
            <h1>Kasir - Transaksi</h1>
            <div class="card">
                <input type="text" id="scanKasir" onkeypress="handleKasirScan(event)" placeholder="Cari Nama/Barcode...">
                <table class="excel-table">
                    <thead><tr><th>Produk</th><th>Harga</th><th>Qty</th><th>Aksi</th></tr></thead>
                    <tbody id="keranjangTabel"></tbody>
                </table>
                <h2 id="displayTotal" style="text-align:right">Total: Rp 0</h2>
                <button class="btn btn-success" onclick="prosesTransaksi()">CETAK STRUK</button>
            </div>
        </div>

        <div id="manajemenUser" class="page">
            <h1>Pengaturan User & Kasir</h1>
            <div style="display: grid; grid-template-columns: 320px 1fr; gap: 20px;">
                <div class="card">
                    <h3>Tambah User Baru</h3>
                    <input type="text" id="uNamaKasir" placeholder="Nama Lengkap">
                    <input type="text" id="uUsername" placeholder="Username Baru">
                    <input type="password" id="uPassword" placeholder="Password Baru">
                    <select id="uRole">
                        <option value="kasir">Akses Kasir</option>
                        <option value="admin">Akses Admin (Full)</option>
                    </select>
                    <button class="btn btn-success" style="width: 100%" onclick="tambahUser()">SIMPAN USER</button>
                </div>
                <div class="card">
                    <h3>Daftar Pengguna Aktif</h3>
                    <table class="excel-table">
                        <thead><tr><th>Nama</th><th>Username</th><th>Role</th><th>Aksi</th></tr></thead>
                        <tbody id="bodyUser"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="masterBarang" class="page"><h1>Master Barang</h1></div>
        <div id="dashboard" class="page"><h1>Dashboard</h1></div>
        <div id="laporan" class="page"><h1>Laporan</h1></div>
    </div>
</div>

<div id="areaStruk"></div>

<script>
    // Inisialisasi Database User (Default awal)
    let dbUsers = JSON.parse(localStorage.getItem('db_users')) || [
        { nama: 'Owner', user: 'admin', pass: '123', role: 'admin' }
    ];

    let dbBarang = JSON.parse(localStorage.getItem('v8_barang')) || [];
    let dbRiwayat = JSON.parse(localStorage.getItem('v8_riwayat')) || [];
    let keranjang = [];
    let totalBelanja = 0;

    // LOGIN SYSTEM DENGAN DATABASE DINAMIS
    function doLogin() {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;

        const akun = dbUsers.find(x => x.user === u && x.pass === p);

        if (akun) {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('displayUser').innerText = akun.nama;
            
            // Atur Hak Akses Menu
            const isAdmin = (akun.role === 'admin');
            document.getElementById('menuAdminOnly').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('menuLaporanOnly').style.display = isAdmin ? 'block' : 'none';
            
            if(!isAdmin) showPage('transaksi');
        } else {
            alert("Username atau Password Salah!");
        }
    }

    function doLogout() { location.reload(); }

    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if (id === 'manajemenUser') renderUserTable();
    }

    // FUNGSI MANAJEMEN USER
    function tambahUser() {
        const n = document.getElementById('uNamaKasir').value;
        const u = document.getElementById('uUsername').value;
        const p = document.getElementById('uPassword').value;
        const r = document.getElementById('uRole').value;

        if(!n || !u || !p) return alert("Lengkapi data user!");
        
        dbUsers.push({ nama: n, user: u, pass: p, role: r });
        localStorage.setItem('db_users', JSON.stringify(dbUsers));
        
        alert("User Berhasil Ditambahkan!");
        renderUserTable();
        document.getElementById('uNamaKasir').value = '';
        document.getElementById('uUsername').value = '';
        document.getElementById('uPassword').value = '';
    }

    function renderUserTable() {
        const b = document.getElementById('bodyUser'); b.innerHTML = '';
        dbUsers.forEach((x, i) => {
            b.innerHTML += `<tr>
                <td>${x.nama}</td>
                <td>${x.user}</td>
                <td>${x.role.toUpperCase()}</td>
                <td><button class="btn-danger" onclick="hapusUser(${i})">Hapus</button></td>
            </tr>`;
        });
    }

    function hapusUser(i) {
        if(dbUsers[i].user === 'admin') return alert("User utama tidak bisa dihapus!");
        if(confirm("Hapus user ini?")) {
            dbUsers.splice(i, 1);
            localStorage.setItem('db_users', JSON.stringify(dbUsers));
            renderUserTable();
        }
    }

    // (Fungsi Kasir, Master, Laporan tetap menggunakan logika yang sama dengan v8)
    function handleKasirScan(e) { /* Logika Scan */ }
    function prosesTransaksi() { /* Logika Cetak */ }
</script>
</body>
</html>
