<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kasir Warung - Mode Trial</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
        .container { max-width: 500px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin: auto; }
        .header { text-align: center; border-bottom: 2px solid #eee; margin-bottom: 20px; }
        .badge-trial { background: #ff9800; color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #1976D2; }
        .item-list { margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px; }
        .item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px id="eee" solid; }
        
        /* Modal Upgrade */
        #modalUpgrade { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 400px; }
        .wa-button { background: #25D366; color: white; text-decoration: none; padding: 10px 20px; border-radius: 5px; display: inline-block; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>Kasir Warung <span class="badge-trial">TRIAL</span></h2>
        <p id="infoStatus">Maksimal 10 Item Barang</p>
    </div>

    <div id="formInput">
        <input type="text" id="namaBarang" placeholder="Nama Barang (Contoh: Kopi)">
        <input type="number" id="hargaBarang" placeholder="Harga (Contoh: 5000)">
        <button onclick="simpanBarang()">Tambah ke Stok</button>
    </div>

    <div class="item-list" id="daftarBarang">
        <strong>Stok Saat Ini:</strong>
        <div id="listKonten">Memuat data...</div>
    </div>
</div>

<div id="modalUpgrade">
    <div class="modal-content">
        <h2 style="color: #d32f2f;">Masa Trial Habis!</h2>
        <p>Anda telah mencapai batas maksimal <b>10 item</b> untuk versi gratis.</p>
        <p>Beralih ke versi <b>PRO</b> untuk input barang tanpa batas, laporan laba, dan fitur cetak struk.</p>
        <hr>
        <p>Hubungi Admin untuk Aktivasi:</p>
        <a href="https://wa.me/6285215220987?text=Halo%20Admin,%20saya%20ingin%20upgrade%20aplikasi%20kasir%20ke%20versi%20Full" class="wa-button">Hubungi via WhatsApp</a>
    </div>
</div>

<script>
    // 1. KONFIGURASI FIREBASE (GANTI DENGAN PUNYA ANDA)
    const firebaseConfig = {
        apiKey: "AIzaSy...",
        authDomain: "warung-anda.firebaseapp.com",
        databaseURL: "https://warung-anda-default-rtdb.firebaseio.com",
        projectId: "warung-anda",
        storageBucket: "warung-anda.appspot.com",
        messagingSenderId: "123456789",
        appId: "1:123456789:web:abcdef..."
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const BATAS_TRIAL = 10;

    // 2. FUNGSI SIMPAN BARANG DENGAN PENGECEKAN TRIAL
    function simpanBarang() {
        const nama = document.getElementById('namaBarang').value;
        const harga = document.getElementById('hargaBarang').value;

        if (nama === "" || harga === "") {
            alert("Isi data dengan lengkap!");
            return;
        }

        // Cek jumlah item di database
        db.ref('stok_barang').once('value', (snapshot) => {
            const jumlahItem = snapshot.numChildren();

            if (jumlahItem >= BATAS_TRIAL) {
                // Tampilkan Modal Upgrade jika sudah mencapai batas
                document.getElementById('modalUpgrade').style.display = 'flex';
            } else {
                // Simpan data jika masih dalam batas trial
                db.ref('stok_barang').push({
                    nama: nama,
                    harga: harga,
                    waktu: new Date().toLocaleString()
                });
                document.getElementById('namaBarang').value = "";
                document.getElementById('hargaBarang').value = "";
                alert("Barang berhasil disimpan!");
            }
        });
    }

    // 3. MENAMPILKAN DATA SECARA REALTIME
    db.ref('stok_barang').on('value', (snapshot) => {
        const listKonten = document.getElementById('listKonten');
        const infoStatus = document.getElementById('infoStatus');
        const data = snapshot.val();
        let html = "";
        let count = 0;

        if (data) {
            for (let id in data) {
                count++;
                html += `<div class="item">
                            <span>${data[id].nama}</span>
                            <span>Rp ${data[id].harga}</span>
                         </div>`;
            }
            listKonten.innerHTML = html;
        } else {
            listKonten.innerHTML = "Belum ada barang.";
        }
        
        infoStatus.innerText = `Terpakai: ${count} / ${BATAS_TRIAL} Item`;
    });
</script>

</body>
</html>
